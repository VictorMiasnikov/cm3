<HTML>
<HEAD>
<TITLE>Critical Mass Modula-3: obliqrt/derived/ObValueCB.m3</TITLE>
</HEAD>
<BODY bgcolor="#ffffff">
<A NAME="0TOP0">
<H2>obliqrt/derived/ObValueCB.m3</H2></A><HR>
<inModule>
<PRE></PRE>********************************************************************
 * ObValueCB.m3
 * DO NOT EDIT --&gt; generated by /home/wagner/work/cm3/m3-comm/sharedobjgen/AMD64_LINUX/shobjcodegen
 *                 Wed Apr  8 01:18:30 CEST 2009
 ********************************************************************

<P><PRE>MODULE <module>ObValueCB</module> EXPORTS <A HREF="ObValueCB.i3.html"><implements>ObValueCB</A></implements>, <A HREF="ObValueCBProxy.i3.html"><implements>ObValueCBProxy</A></implements>;
IMPORT <A HREF="../../sharedobj/src/WeakerRef.i3.html">WeakerRef</A>, <A HREF="../../sharedobj/derived/WeakRefListFuncs.i3.html">WeakRefListFuncs</A>, <A HREF="../../sharedobj/src/SharedObjRep.i3.html">SharedObjRep</A>, <A HREF="../../sharedobj/derived/WeakRefList.i3.html">WeakRefList</A>, <A HREF="../src/ObValueRep.i3.html">ObValueRep</A>,
       <A HREF="../src/ObValue.i3.html">ObValue</A>, <A HREF="../../sharedobj/src/SharedObjStubLib.i3.html">SharedObjStubLib</A>, <A HREF="../../m3core/src/weakref/WeakRef.i3.html">WeakRef</A>;

REVEAL
  <A NAME="ReplObjStd">ReplObjStd</A> = PublicReplObjStd BRANDED OBJECT
    obj: ObValue.ReplObjStd;
    wref: WeakerRef.T;
  OVERRIDES
    init := Init_ReplObjStd;
    cancel := Cancel_ReplObjStd;
    pre_anyChange := Pre_anyChange_ReplObjStd;
    post_anyChange := Post_anyChange_ReplObjStd;
    pre_InvokeUpdate := Pre_InvokeUpdate_ReplObjStd;
    post_InvokeUpdate := Post_InvokeUpdate_ReplObjStd;
    pre_init := Pre_init_ReplObjStd;
    post_init := Post_init_ReplObjStd;
    pre_Update := Pre_Update_ReplObjStd;
    post_Update := Post_Update_ReplObjStd;
  END;

PROCEDURE <A NAME="Init_ReplObjStd"><procedure>Init_ReplObjStd</procedure></A> (self: ReplObjStd;
                           obj: ObValue.ReplObjStd): ReplObjStd =
  VAR
    wref := NEW(WeakerRef.T,
                weakRef := WeakRef.FromRef(self, Cleanup_ReplObjStd_CB),
                ready := TRUE);
  BEGIN
    self.obj := obj;
    self.wref := wref;
    IF MkProxyReplObjStdCB # NIL AND self.proxy = NIL THEN
      MkProxyReplObjStdCB (self);
    END;
    SharedObjStubLib.AcquireWriteLock(obj);
    TRY
      obj.callbacks := WeakRefList.Cons(wref, obj.callbacks);
    FINALLY
      SharedObjStubLib.ReleaseWriteLock(obj);
    END;
    RETURN self;
  END Init_ReplObjStd;

PROCEDURE <A NAME="Cancel_ReplObjStd"><procedure>Cancel_ReplObjStd</procedure></A> (self: ReplObjStd) =
  BEGIN
    SharedObjStubLib.AcquireWriteLock(self.obj);
    TRY
      EVAL WeakRefListFuncs.DeleteD(self.obj.callbacks, self.wref);
    FINALLY
      SharedObjStubLib.ReleaseWriteLock(self.obj);
    END;
  END Cancel_ReplObjStd;

PROCEDURE <A NAME="Cleanup_ReplObjStd_CB"><procedure>Cleanup_ReplObjStd_CB</procedure></A> (READONLY wref: WeakRef.T; ref: REFANY) =
  VAR
    cb := NARROW(ref, ReplObjStd);
    weakerRef := NEW(WeakerRef.T, weakRef := wref);
  BEGIN
    SharedObjStubLib.AcquireWriteLock(cb.obj);
    TRY
      (* Callback is gone, so delete it *)
      EVAL WeakRefListFuncs.DeleteD(cb.obj.callbacks, weakerRef);
    FINALLY
      SharedObjStubLib.ReleaseWriteLock(cb.obj);
    END;
  END Cleanup_ReplObjStd_CB;

PROCEDURE <A NAME="Pre_anyChange_ReplObjStd"><procedure>Pre_anyChange_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd) =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      NARROW (self.proxy, CBProxyReplObjStd).pre_anyChange (obj);
    END;
  END Pre_anyChange_ReplObjStd;

PROCEDURE <A NAME="Post_anyChange_ReplObjStd"><procedure>Post_anyChange_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd) =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      NARROW (self.proxy, CBProxyReplObjStd).post_anyChange (obj);
    END;
  END Post_anyChange_ReplObjStd;

PROCEDURE <A NAME="Pre_InvokeUpdate_ReplObjStd"><procedure>Pre_InvokeUpdate_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd;
                                       label: TEXT;
                                       argNo: INTEGER;
                                       READONLY args: ObValue.Vals;
                                       VAR hint: INTEGER): BOOLEAN =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      RETURN NARROW (self.proxy, CBProxyReplObjStd).pre_InvokeUpdate (obj,
                                                                      label,
                                                                      argNo,
                                                                      args,
                                                                      hint);
      END;
    RETURN FALSE;
  END Pre_InvokeUpdate_ReplObjStd;

PROCEDURE <A NAME="Post_InvokeUpdate_ReplObjStd"><procedure>Post_InvokeUpdate_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd;
                                        label: TEXT;
                                        argNo: INTEGER;
                                        READONLY args: ObValue.Vals;
                                        VAR hint: INTEGER): BOOLEAN =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      RETURN NARROW (self.proxy, CBProxyReplObjStd).post_InvokeUpdate (obj,
                                                                       label,
                                                                       argNo,
                                                                       args,
                                                                       hint);
      END;
    RETURN FALSE;
  END Post_InvokeUpdate_ReplObjStd;

PROCEDURE <A NAME="Pre_init_ReplObjStd"><procedure>Pre_init_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd): BOOLEAN =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      RETURN NARROW (self.proxy, CBProxyReplObjStd).pre_init (obj);
      END;
    RETURN FALSE;
  END Pre_init_ReplObjStd;

PROCEDURE <A NAME="Post_init_ReplObjStd"><procedure>Post_init_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd): BOOLEAN =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      RETURN NARROW (self.proxy, CBProxyReplObjStd).post_init (obj);
      END;
    RETURN FALSE;
  END Post_init_ReplObjStd;

PROCEDURE <A NAME="Pre_Update_ReplObjStd"><procedure>Pre_Update_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd;
                                 label: TEXT;
                                 val: ObValue.Val;
                                 internal: BOOLEAN;
                                 VAR hint: INTEGER): BOOLEAN =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      RETURN NARROW (self.proxy, CBProxyReplObjStd).pre_Update (obj, label,
                                                                val,
                                                                internal,
                                                                hint);
      END;
    RETURN FALSE;
  END Pre_Update_ReplObjStd;

PROCEDURE <A NAME="Post_Update_ReplObjStd"><procedure>Post_Update_ReplObjStd</procedure></A> (self: ReplObjStd; READONLY obj: ObValue.ReplObjStd;
                                  label: TEXT;
                                  val: ObValue.Val;
                                  internal: BOOLEAN;
                                  VAR hint: INTEGER): BOOLEAN =
  BEGIN
    (* Default calls proxy or does nothing. *)
    IF self.proxy # NIL THEN
      RETURN NARROW (self.proxy, CBProxyReplObjStd).post_Update (obj,
                                                                 label,
                                                                 val,
                                                                 internal,
                                                                 hint);
      END;
    RETURN FALSE;
  END Post_Update_ReplObjStd;

BEGIN
SharedObjStubLib.InhibitTransmission(TYPECODE(ReplObjStd), &quot;default ReplObjStd callback cannot be transmitted/duplicated&quot;);
END ObValueCB.
</PRE>
</inModule>
<PRE>























</PRE>
</BODY>
</HTML>
